
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>YouTube ë°°ê²½í™”ë©´ ì´ë¯¸ì§€ ìƒì„±ê¸°</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    </head>
    <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
        <div class="container mx-auto px-4 py-8 max-w-4xl">
            <!-- í—¤ë” -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1 class="text-4xl font-bold text-gray-800 mb-2 flex items-center">
                    <i class="fas fa-images mr-3 text-blue-600"></i>
                    YouTube ë°°ê²½í™”ë©´ ì´ë¯¸ì§€ ìƒì„±ê¸°
                </h1>
                <p class="text-gray-600">ë¬¸ë‹¨ì„ ì…ë ¥í•˜ë©´ Nano Banana Proìš© í”„ë¡¬í”„íŠ¸ë¥¼ ìë™ ìƒì„±í•©ë‹ˆë‹¤</p>
                <div class="mt-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                    <div class="flex items-start">
                        <i class="fas fa-lightbulb text-blue-600 mt-1 mr-2"></i>
                        <div class="text-sm text-blue-800">
                            <strong>ì‚¬ìš© ë°©ë²•:</strong>
                            <ol class="list-decimal ml-5 mt-2 space-y-1">
                                <li>ì•„ë˜ì— ë¬¸ë‹¨ì„ ì…ë ¥í•˜ì„¸ìš” (ê° ì¤„ì´ í•˜ë‚˜ì˜ ì´ë¯¸ì§€ê°€ ë©ë‹ˆë‹¤)</li>
                                <li>"í”„ë¡¬í”„íŠ¸ ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</li>
                                <li>ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ë¥¼ ë³µì‚¬í•˜ì„¸ìš”</li>
                                <li>GenSpark Image Designerì—ì„œ í”„ë¡¬í”„íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ì„¸ìš”</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì…ë ¥ ì„¹ì…˜ -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-edit mr-2 text-purple-600"></i>
                    ë¬¸ë‹¨ ì…ë ¥
                </h2>
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-gray-700 font-semibold">ì˜ìƒ ì œëª©:</label>
                        <button onclick="recommendTitle()" 
                                class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-1 px-3 rounded-lg shadow transition text-sm">
                            <i class="fas fa-lightbulb mr-1"></i>AI ì œëª© ì¶”ì²œ
                        </button>
                    </div>
                    <input type="text" id="videoTitle" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="ì˜ˆ: ì„±ê³µí•˜ëŠ” ì‚¬ëŒë“¤ì˜ ì•„ì¹¨ ë£¨í‹´"
                           value="ê°€ë‚œì—ì„œ ë²—ì–´ë‚˜ëŠ” ì‚¬ëŒë“¤ì˜ ë¹„ë°€">
                    <div id="titleRecommendations" class="mt-2 space-y-2 hidden"></div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">ìŠ¤í† ë¦¬ ì „ì²´ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</label>
                    <textarea id="storyText" 
                              class="w-full h-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm"
                              placeholder="YouTube ì˜ìƒì˜ ì „ì²´ ìŠ¤í† ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
AIê°€ ìë™ìœ¼ë¡œ ì”¬ì„ ë¶„ì„í•˜ì—¬ 3-10ì´ˆ ê°„ê²©ìœ¼ë¡œ ë¶„í• í•©ë‹ˆë‹¤.

ì˜ˆì‹œ:
1974ë…„, ë¯¸êµ­ í•œ ëŒ€í•™êµì˜ ê°•ì—°ì¥ì— ë ˆì´ A. í¬ë¡ì´ ì—°ì„¤ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë§¥ë„ë‚ ë“œ ì°½ì—…ì ë ˆì´ A. í¬ë¡ì€ í•™ìƒë“¤ì—ê²Œ ì„±ê³µì˜ ë¹„ê²°ì— ëŒ€í•´ ì´ì•¼ê¸°í•©ë‹ˆë‹¤. 'ì„±ê³µì˜ ë¹„ê²°ì€ ëˆê¸°ì™€ ë¹„ì „ì…ë‹ˆë‹¤. í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”.' í•™ìƒë“¤ì€ í¬ë¡ì˜ ì—´ì •ì ì¸ ê°•ì—°ì— ê²½ì²­í•˜ë©° ë©”ëª¨ë¥¼ í•©ë‹ˆë‹¤.">1974ë…„, ë¯¸êµ­ í•œ ëŒ€í•™êµì˜ ê°•ì—°ì¥ì— ë ˆì´ A. í¬ë¡(Ray A. Kroc)ì´ ì—°ì„¤ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë§¥ë„ë‚ ë“œ ì°½ì—…ì ë ˆì´ A. í¬ë¡ì€ í•™ìƒë“¤ì—ê²Œ ì„±ê³µì˜ ë¹„ê²°ì— ëŒ€í•´ ì´ì•¼ê¸°í•©ë‹ˆë‹¤. "ì„±ê³µì˜ ë¹„ê²°ì€ ëˆê¸°ì™€ ë¹„ì „ì…ë‹ˆë‹¤. í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”." í•™ìƒë“¤ì€ í¬ë¡ì˜ ì—´ì •ì ì¸ ê°•ì—°ì— ê²½ì²­í•˜ë©° ë©”ëª¨ë¥¼ í•©ë‹ˆë‹¤.</textarea>
                </div>
                <div class="mb-4 p-3 bg-purple-50 border border-purple-200 rounded-lg">
                    <div class="flex items-start gap-2">
                        <i class="fas fa-magic text-purple-600 mt-1"></i>
                        <div class="text-sm text-purple-800">
                            <strong>AI ìë™ ì”¬ ë¶„ì„:</strong> ìŠ¤í† ë¦¬ë¥¼ ì…ë ¥í•˜ë©´ AIê°€ ìë™ìœ¼ë¡œ ì¥ë©´ ì „í™˜ì´ í•„ìš”í•œ ë¶€ë¶„ì„ ê°ì§€í•˜ì—¬ 
                            3-10ì´ˆ ê°„ê²©ìœ¼ë¡œ ì”¬ì„ ë¶„í• í•˜ê³ , ê° ì”¬ë§ˆë‹¤ ìµœì ì˜ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <button onclick="alert('âœ… JavaScriptê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤! ì´ì œ ì•„ë˜ ë³´ë¼ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.')" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow transition">
                        <i class="fas fa-check-circle mr-2"></i>
                        ğŸ§ª í…ŒìŠ¤íŠ¸: JavaScript ì‘ë™ í™•ì¸ (ë¨¼ì € í´ë¦­í•´ë³´ì„¸ìš”)
                    </button>
                </div>
                <div class="flex gap-4">
                    <button id="analyzeButton" onclick="analyzeAndGenerate()" 
                            class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300 transform hover:scale-105">
                        <i class="fas fa-magic mr-2"></i>
                        <span id="buttonText">AI ì”¬ ë¶„ì„ & ì´ë¯¸ì§€ ìƒì„±</span>
                    </button>
                    <button onclick="clearAll()" 
                            class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300">
                        <i class="fas fa-trash mr-2"></i>
                        ì´ˆê¸°í™”
                    </button>
                </div>
                <div id="buttonStatus" class="mt-2 text-sm text-center hidden"></div>
            </div>

            <!-- ì”¬ ë¶„ì„ ê²°ê³¼ ì„¹ì…˜ -->
            <div id="sceneAnalysisSection" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-film mr-2 text-indigo-600"></i>
                    AI ì”¬ ë¶„ì„ ê²°ê³¼
                </h2>
                <div id="sceneList" class="space-y-3"></div>
                <div class="mt-4 flex justify-end">
                    <button onclick="startImageGeneration()" 
                            class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-300">
                        <i class="fas fa-play mr-2"></i>
                        ì´ë¯¸ì§€ ìƒì„± ì‹œì‘
                    </button>
                </div>
            </div>

            <!-- ì´ë¯¸ì§€ ìƒì„± ì§„í–‰ ìƒí™© ì„¹ì…˜ -->
            <div id="generationProgressSection" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-spinner fa-spin mr-2 text-purple-600"></i>
                    ì´ë¯¸ì§€ ìƒì„± ì¤‘...
                </h2>
                <div id="progressList" class="space-y-4"></div>
            </div>

            <!-- ìƒì„± ì™„ë£Œ ì„¹ì…˜ -->
            <div id="completedSection" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-check-circle mr-2 text-green-600"></i>
                        ìƒì„± ì™„ë£Œ
                    </h2>
                    <button onclick="downloadAllImages()" 
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition duration-300">
                        <i class="fas fa-download mr-2"></i>
                        ì „ì²´ ë‹¤ìš´ë¡œë“œ (ZIP)
                    </button>
                </div>
                <div id="completedGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>

            <!-- ì¸ë„¤ì¼ ìƒì„± ì„¹ì…˜ -->
            <div id="thumbnailSection" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-image mr-2 text-pink-600"></i>
                    YouTube ì¸ë„¤ì¼
                </h2>
                <div id="thumbnailStatus" class="mb-4 p-3 bg-gray-100 rounded-lg text-center">
                    ëŒ€ê¸° ì¤‘...
                </div>
                <div id="thumbnailPreview" class="mb-4 hidden">
                    <img src="" alt="Thumbnail" class="w-full rounded-lg shadow-md">
                </div>
                <div class="text-center">
                    <a id="thumbnailDownload" href="#" download="thumbnail.png" 
                       class="hidden inline-block bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition">
                        <i class="fas fa-download mr-2"></i>ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ
                    </a>
                </div>
            </div>

            <!-- ê²°ê³¼ ì„¹ì…˜ -->
            <div id="resultSection" class="bg-white rounded-lg shadow-lg p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-list mr-2 text-green-600"></i>
                        ìƒì„±ëœ í”„ë¡¬í”„íŠ¸
                    </h2>
                    <button onclick="downloadJSON()" 
                            class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition duration-300">
                        <i class="fas fa-download mr-2"></i>
                        JSON ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>
                
                <div id="summary" class="mb-4 p-4 bg-blue-50 rounded-lg"></div>
                
                <div id="promptList" class="space-y-4"></div>
            </div>
        </div>

        <script>
            console.log('ğŸ¬ YouTube ë°°ê²½í™”ë©´ ì´ë¯¸ì§€ ìƒì„±ê¸° ë¡œë“œë¨');
            
            const STYLE_PROMPT = 'Style: Digital illustration with hand-drawn effect, warm earthy colors (browns, beiges, soft blues), simple cartoonish characters with expressive faces, brick wall background with windows, educational atmosphere, Korean text integrated naturally like chalk on blackboard or subtitles.';
            const REFERENCE_IMAGE = 'https://www.genspark.ai/api/files/s/57W955Hh';
            
            let sceneList = [];
            let generatedImages = [];
            let generatedAudios = [];
            let previousAudioParams = null; // ìŒì„± ì¼ê´€ì„± ìœ ì§€ìš©
            
            // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í™•ì¸
            window.addEventListener('DOMContentLoaded', () => {
                console.log('âœ… DOM ë¡œë“œ ì™„ë£Œ');
                console.log('ğŸ”˜ analyzeAndGenerate í•¨ìˆ˜ ì •ì˜ë¨:', typeof analyzeAndGenerate);
                
                // ë²„íŠ¼ì— ì¶”ê°€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                const analyzeButton = document.getElementById('analyzeButton');
                if (analyzeButton) {
                    console.log('âœ… analyzeButton ì°¾ìŒ');
                    analyzeButton.addEventListener('click', () => {
                        console.log('ğŸ–±ï¸ ë²„íŠ¼ í´ë¦­ ê°ì§€ë¨!');
                    });
                } else {
                    console.error('âŒ analyzeButtonì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
            });


            async function analyzeAndGenerate() {
                console.log('âœ… analyzeAndGenerate í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                // ë²„íŠ¼ ìƒíƒœ ë³€ê²½ (ì¦‰ì‹œ í”¼ë“œë°±)
                const analyzeButton = document.getElementById('analyzeButton');
                const buttonText = document.getElementById('buttonText');
                const buttonStatus = document.getElementById('buttonStatus');
                
                if (analyzeButton) {
                    analyzeButton.disabled = true;
                    analyzeButton.classList.add('opacity-50', 'cursor-not-allowed');
                }
                
                if (buttonText) {
                    buttonText.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ë¶„ì„ ì¤‘...';
                }
                
                if (buttonStatus) {
                    buttonStatus.classList.remove('hidden');
                    buttonStatus.innerHTML = '<div class="text-blue-600 font-semibold">ğŸ”„ ë²„íŠ¼ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤! AIê°€ ìŠ¤í† ë¦¬ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>';
                }
                
                const storyText = document.getElementById('storyText').value.trim();
                console.log('ğŸ“ ìŠ¤í† ë¦¬ í…ìŠ¤íŠ¸:', storyText ? 'ì…ë ¥ë¨ (ê¸¸ì´: ' + storyText.length + ')' : 'ë¹„ì–´ìˆìŒ');
                
                if (!storyText) {
                    alert('ìŠ¤í† ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    // ë²„íŠ¼ ë³µêµ¬
                    if (analyzeButton) {
                        analyzeButton.disabled = false;
                        analyzeButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                    if (buttonText) {
                        buttonText.innerHTML = 'AI ì”¬ ë¶„ì„ & ì´ë¯¸ì§€ ìƒì„±';
                    }
                    if (buttonStatus) {
                        buttonStatus.classList.add('hidden');
                    }
                    return;
                }

                // ì”¬ ë¶„ì„ ìš”ì²­
                const sceneAnalysisSection = document.getElementById('sceneAnalysisSection');
                console.log('ğŸ” sceneAnalysisSection ìš”ì†Œ:', sceneAnalysisSection ? 'ì°¾ìŒ' : 'ì—†ìŒ');
                
                sceneAnalysisSection.classList.remove('hidden');
                sceneAnalysisSection.scrollIntoView({ behavior: 'smooth' });

                const sceneListEl = document.getElementById('sceneList');
                sceneListEl.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i><p class="text-gray-600">AIê°€ ìŠ¤í† ë¦¬ë¥¼ ë¶„ì„í•˜ì—¬ ì”¬ì„ ë¶„í• í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p></div>';

                console.log('ğŸš€ API í˜¸ì¶œ ì‹œì‘...');
                try {
                    const response = await fetch('/api/analyze-scenes', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ story: storyText })
                    });

                    const data = await response.json();
                    console.log('ğŸ“¨ API ì‘ë‹µ:', data);
                    
                    if (data.success) {
                        sceneList = data.scenes;
                        console.log('âœ… ì”¬ ë¶„ì„ ì„±ê³µ! ì”¬ ê°œìˆ˜:', sceneList.length);
                        displayScenes();
                        
                        // ë²„íŠ¼ ë³µêµ¬
                        if (analyzeButton) {
                            analyzeButton.disabled = false;
                            analyzeButton.classList.remove('opacity-50', 'cursor-not-allowed');
                        }
                        if (buttonText) {
                            buttonText.innerHTML = 'AI ì”¬ ë¶„ì„ & ì´ë¯¸ì§€ ìƒì„±';
                        }
                        if (buttonStatus) {
                            buttonStatus.innerHTML = '<div class="text-green-600 font-semibold">âœ… ë¶„ì„ ì™„ë£Œ! ì•„ë˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>';
                            setTimeout(() => {
                                buttonStatus.classList.add('hidden');
                            }, 3000);
                        }
                    } else {
                        throw new Error(data.error || 'ì”¬ ë¶„ì„ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    console.error('âŒ ì˜¤ë¥˜ ë°œìƒ:', error);
                    alert('ì”¬ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
                    sceneAnalysisSection.classList.add('hidden');
                    
                    // ë²„íŠ¼ ë³µêµ¬
                    if (analyzeButton) {
                        analyzeButton.disabled = false;
                        analyzeButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                    if (buttonText) {
                        buttonText.innerHTML = 'AI ì”¬ ë¶„ì„ & ì´ë¯¸ì§€ ìƒì„±';
                    }
                    if (buttonStatus) {
                        buttonStatus.innerHTML = '<div class="text-red-600 font-semibold">âŒ ì˜¤ë¥˜ ë°œìƒ: ' + error.message + '</div>';
                    }
                }
            }

            function displayScenes() {
                const sceneListEl = document.getElementById('sceneList');
                sceneListEl.innerHTML = '';

                let totalDuration = 0;
                sceneList.forEach((scene, index) => {
                    totalDuration += scene.duration;
                    
                    const sceneCard = document.createElement('div');
                    sceneCard.className = 'border-l-4 border-blue-500 bg-blue-50 p-4 rounded-r-lg';
                    sceneCard.innerHTML = '<div class="flex justify-between items-start mb-2">' +
                            '<div>' +
                                '<span class="font-semibold text-gray-800">ì”¬ ' + (index + 1) + '</span>' +
                                '<span class="ml-2 text-xs bg-indigo-600 text-white px-2 py-1 rounded">' + (scene.sceneType || 'ì¥ë©´') + '</span>' +
                            '</div>' +
                            '<div class="flex gap-2">' +
                                '<span class="text-xs bg-blue-600 text-white px-2 py-1 rounded">' +
                                    '<i class="fas fa-clock mr-1"></i>' + scene.duration + 'ì´ˆ' +
                                '</span>' +
                                '<span class="text-xs bg-purple-600 text-white px-2 py-1 rounded">' +
                                    '<i class="fas fa-video mr-1"></i>' + scene.startTime + 's - ' + scene.endTime + 's' +
                                '</span>' +
                            '</div>' +
                        '</div>' +
                        '<p class="text-gray-700 mb-2 font-medium">' + scene.description + '</p>' +
                        '<div class="text-xs text-gray-500 bg-white p-2 rounded">' +
                            '<strong>ì‹œê°ì  ìš”ì†Œ:</strong> ' + scene.visualElements +
                        '</div>';
                    sceneListEl.appendChild(sceneCard);
                });

                // ìš”ì•½ ì •ë³´ ì¶”ê°€
                const summary = document.createElement('div');
                summary.className = 'mt-4 p-4 bg-green-50 border-l-4 border-green-500 rounded-r-lg';
                summary.innerHTML = '<div class="flex items-center justify-between">' +
                        '<div><i class="fas fa-check-circle text-green-600 mr-2"></i>' +
                        '<strong>ì´ ' + sceneList.length + 'ê°œ ì”¬ ë¶„ì„ ì™„ë£Œ</strong></div>' +
                        '<div class="text-green-800">' +
                        'ì˜ˆìƒ ì´ ì˜ìƒ ê¸¸ì´: ' + totalDuration + 'ì´ˆ (' + Math.floor(totalDuration / 60) + 'ë¶„ ' + (totalDuration % 60) + 'ì´ˆ)' +
                        '</div>' +
                    '</div>';
                sceneListEl.appendChild(summary);
            }

            async function startImageGeneration() {
                if (!confirm('ì´ ' + sceneList.length + 'ê°œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ê° ì´ë¯¸ì§€ë‹¹ ì•½ 2-3ë¶„ ì†Œìš”ë©ë‹ˆë‹¤.\n\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }

                const generationProgressSection = document.getElementById('generationProgressSection');
                const completedSection = document.getElementById('completedSection');
                
                generationProgressSection.classList.remove('hidden');
                completedSection.classList.add('hidden');
                generationProgressSection.scrollIntoView({ behavior: 'smooth' });

                const progressList = document.getElementById('progressList');
                progressList.innerHTML = '';
                generatedImages = [];

                // ì§„í–‰ ìƒí™© ì¹´ë“œ ìƒì„±
                sceneList.forEach((scene, index) => {
                    const progressCard = document.createElement('div');
                    progressCard.id = 'progress-' + index;
                    progressCard.className = 'border border-gray-200 rounded-lg p-4 bg-white';
                    progressCard.innerHTML = '<div class="flex items-start gap-4">' +
                            '<div class="flex-shrink-0">' +
                                '<div id="status-icon-' + index + '" class="w-16 h-16 flex items-center justify-center">' +
                                    '<div class="w-12 h-12 border-4 border-gray-200 border-t-purple-600 rounded-full animate-spin"></div>' +
                                '</div>' +
                            '</div>' +
                            '<div class="flex-1">' +
                                '<div class="flex justify-between items-start mb-2">' +
                                    '<div class="font-semibold text-gray-800">ì”¬ ' + (index + 1) + '</div>' +
                                    '<span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">' +
                                        scene.duration + 'ì´ˆ' +
                                    '</span>' +
                                '</div>' +
                                '<p class="text-sm text-gray-600 mb-2">' + scene.description + '</p>' +
                                '<div id="status-text-' + index + '" class="text-sm text-gray-500">' +
                                    '<i class="fas fa-hourglass-start mr-1"></i>ëŒ€ê¸° ì¤‘...' +
                                '</div>' +
                                '<div id="image-preview-' + index + '" class="mt-3 hidden">' +
                                    '<img src="" alt="Generated" class="w-full rounded-lg shadow-md">' +
                                '</div>' +
                            '</div>' +
                        '</div>';
                    progressList.appendChild(progressCard);
                });

                // ì´ë¯¸ì§€ ìƒì„± ì‹œì‘
                for (let i = 0; i < sceneList.length; i++) {
                    await generateSceneImage(i);
                }

                // ì™„ë£Œ ì„¹ì…˜ í‘œì‹œ
                displayCompletedImages();
            }

            async function generateSceneImage(index) {
                const scene = sceneList[index];
                const statusIcon = document.getElementById('status-icon-' + index);
                const statusText = document.getElementById('status-text-' + index);
                const imagePreview = document.getElementById('image-preview-' + index);

                try {
                    statusText.innerHTML = '<i class="fas fa-magic mr-1 text-purple-600"></i>AIê°€ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤... (2-3ë¶„ ì†Œìš”)';

                    const prompt = STYLE_PROMPT + '

Reference Image: ' + REFERENCE_IMAGE + '
(Please analyze and replicate the visual style from this reference image)

Scene Description: ' + scene.description + '
Visual Elements: ' + scene.visualElements + '
Duration: ' + scene.duration + ' seconds
Timeline: ' + scene.startTime + 's - ' + scene.endTime + 's

Create an educational illustration that visually represents this scene. 
The image should be engaging, clear, and suitable as a YouTube video background.
Maintain consistent visual language with warm, inviting colors and clear composition.
Aspect ratio: 16:9 for YouTube compatibility.
Use Nano Banana Pro model for best quality.';

                    const response = await fetch('/api/generate-scene-image', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            scene: scene,
                            prompt: prompt,
                            index: index
                        })
                    });

                    const data = await response.json();

                    if (!data.success) {
                        throw new Error(data.error || 'ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨');
                    }

                    // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                    const img = imagePreview.querySelector('img');
                    img.src = data.imageUrl;
                    imagePreview.classList.remove('hidden');

                    // 2ë‹¨ê³„: ìŒì„± ìƒì„±
                    statusText.innerHTML = '<i class="fas fa-microphone mr-1 text-blue-600"></i>ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ! ìŒì„±ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤... (1-2ë¶„ ì†Œìš”)';

                    const audioResponse = await fetch('/api/generate-scene-speech', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            scene: scene,
                            index: index,
                            previousAudioParams: previousAudioParams
                        })
                    });

                    const audioData = await audioResponse.json();

                    let audioUrl = null;
                    if (audioData.success) {
                        audioUrl = audioData.audioUrl;
                        previousAudioParams = audioData.audioParams; // ë‹¤ìŒ ìŒì„± ì¼ê´€ì„± ìœ ì§€
                        console.log('âœ… ì”¬ ' + (index + 1) + ' ìŒì„± ìƒì„± ì„±ê³µ!');
                    } else {
                        console.warn('âš ï¸ ì”¬ ' + (index + 1) + ' ìŒì„± ìƒì„± ì‹¤íŒ¨:', audioData.error);
                    }

                    // ì„±ê³µ ì•„ì´ì½˜ í‘œì‹œ
                    statusIcon.innerHTML = '<i class="fas fa-check-circle text-green-600 text-5xl"></i>';
                    statusText.innerHTML = '<i class="fas fa-check mr-1 text-green-600"></i>ì´ë¯¸ì§€ + ìŒì„± ìƒì„± ì™„ë£Œ!';

                    // ê²°ê³¼ ì €ì¥
                    generatedImages.push({
                        index: index,
                        scene: scene,
                        imageUrl: data.imageUrl,
                        audioUrl: audioUrl
                    });

                    if (audioUrl) {
                        generatedAudios.push({
                            index: index,
                            scene: scene,
                            audioUrl: audioUrl
                        });
                    }

                } catch (error) {
                    statusIcon.innerHTML = '<i class="fas fa-times-circle text-red-600 text-5xl"></i>';
                    statusText.innerHTML = '<i class="fas fa-exclamation-triangle mr-1 text-red-600"></i>ì‹¤íŒ¨: ' + error.message;
                    
                    // ì‹¤íŒ¨í•œ ê²½ìš°ì—ë„ ë¹ˆ í•­ëª© ì¶”ê°€í•˜ì—¬ ì¸ë±ìŠ¤ ìœ ì§€
                    generatedImages.push({
                        index: index,
                        scene: scene,
                        imageUrl: null,
                        audioUrl: null,
                        error: error.message
                    });
                }
            }

            function displayCompletedImages() {
                const completedSection = document.getElementById('completedSection');
                const completedGrid = document.getElementById('completedGrid');
                
                completedSection.classList.remove('hidden');
                completedSection.scrollIntoView({ behavior: 'smooth' });
                completedGrid.innerHTML = '';

                generatedImages.forEach((item) => {
                    if (!item.imageUrl) return; // ì‹¤íŒ¨í•œ í•­ëª© ê±´ë„ˆë›°ê¸°
                    
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition';
                    
                    let audioSection = '';
                    if (item.audioUrl) {
                        audioSection = '<div class="mb-3 bg-gray-50 p-3 rounded">' +
                            '<div class="flex items-center gap-2 mb-2">' +
                                '<i class="fas fa-volume-up text-blue-600"></i>' +
                                '<span class="text-xs font-semibold text-gray-700">ë‚˜ë ˆì´ì…˜</span>' +
                            '</div>' +
                            '<audio controls class="w-full" style="height: 32px;">' +
                                '<source src="' + item.audioUrl + '" type="audio/mp3">' +
                                'ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.' +
                            '</audio>' +
                        '</div>';
                    }
                    
                    card.innerHTML = '<img src="' + item.imageUrl + '" alt="Scene ' + (item.index + 1) + '" class="w-full h-48 object-cover">' +
                        '<div class="p-4">' +
                            '<div class="flex justify-between items-center mb-2">' +
                                '<div class="font-semibold text-gray-800">ì”¬ ' + (item.index + 1) + '</div>' +
                                '<div class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">' +
                                    '<i class="fas fa-clock mr-1"></i>' + item.scene.duration + 'ì´ˆ' +
                                '</div>' +
                            '</div>' +
                            '<p class="text-sm text-gray-600 mb-3">' + item.scene.description.substring(0, 80) + (item.scene.description.length > 80 ? '...' : '') + '</p>' +
                            audioSection +
                            '<div class="flex gap-2">' +
                                '<a href="' + item.imageUrl + '" download="scene_' + String(item.index + 1).padStart(2, '0') + '.png" ' +
                                   'class="flex-1 text-center bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition">' +
                                    '<i class="fas fa-download mr-1"></i>ì´ë¯¸ì§€' +
                                '</a>' +
                                (item.audioUrl ? '<a href="' + item.audioUrl + '" download="scene_' + String(item.index + 1).padStart(2, '0') + '.mp3" ' +
                                   'class="flex-1 text-center bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded transition">' +
                                    '<i class="fas fa-download mr-1"></i>ìŒì„±' +
                                '</a>' : '') +
                                '<button onclick="regenerateImage(' + item.index + ')" ' +
                                        'class="bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 px-4 rounded transition">' +
                                    '<i class="fas fa-redo mr-1"></i>ì¬ìƒì„±' +
                                '</button>' +
                            '</div>' +
                        '</div>';
                    completedGrid.appendChild(card);
                });

                // ì¸ë„¤ì¼ ìƒì„± ë²„íŠ¼ ì¶”ê°€
                const thumbnailSection = document.createElement('div');
                thumbnailSection.className = 'col-span-full mt-6 text-center';
                thumbnailSection.innerHTML = '<button onclick="generateThumbnail()" ' +
                            'class="bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-lg shadow-lg transition duration-300 transform hover:scale-105">' +
                        '<i class="fas fa-image mr-2"></i>ì¸ë„¤ì¼ ìƒì„±í•˜ê¸°' +
                    '</button>' +
                    '<p class="text-sm text-gray-600 mt-2">ì˜ìƒ ì œëª©ì„ ê¸°ë°˜ìœ¼ë¡œ ë§¤ë ¥ì ì¸ ì¸ë„¤ì¼ì„ ìƒì„±í•©ë‹ˆë‹¤</p>';
                completedGrid.appendChild(thumbnailSection);
            }

            function clearAll() {
                if (confirm('ëª¨ë“  ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    document.getElementById('videoTitle').value = '';
                    document.getElementById('storyText').value = '';
                    document.getElementById('sceneAnalysisSection').classList.add('hidden');
                    document.getElementById('generationProgressSection').classList.add('hidden');
                    document.getElementById('completedSection').classList.add('hidden');
                    document.getElementById('thumbnailSection').classList.add('hidden');
                    sceneList = [];
                    generatedImages = [];
                    generatedAudios = [];
                    previousAudioParams = null;
                }
            }

            async function regenerateImage(index) {
                if (!confirm('ì”¬ ' + (index + 1) + 'ì˜ ì´ë¯¸ì§€ë¥¼ ë‹¤ì‹œ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì•½ 2-3ë¶„ ì†Œìš”)')) {
                    return;
                }

                const scene = sceneList[index];
                const progressCard = document.getElementById('progress-' + index);
                
                if (!progressCard) {
                    alert('ì§„í–‰ ìƒí™© ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // ì§„í–‰ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                const generationProgressSection = document.getElementById('generationProgressSection');
                generationProgressSection.classList.remove('hidden');
                generationProgressSection.scrollIntoView({ behavior: 'smooth' });

                // ì¬ìƒì„± ì‹œì‘
                await generateSceneImage(index);

                // ì™„ë£Œëœ ì´ë¯¸ì§€ ëª©ë¡ ì—…ë°ì´íŠ¸
                displayCompletedImages();
            }

            async function downloadAllImages() {
                if (generatedImages.length === 0) {
                    alert('ë‹¤ìš´ë¡œë“œí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!');
                    return;
                }

                const audioCount = generatedImages.filter(item => item.audioUrl).length;
                const confirmMessage = 'ì´ ' + generatedImages.length + 'ê°œ ì´ë¯¸ì§€' + 
                    (audioCount > 0 ? ' + ' + audioCount + 'ê°œ ìŒì„±' : '') + 
                    'ì„ ZIP íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
                
                if (!confirm(confirmMessage)) {
                    return;
                }

                try {
                    // JSZip ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë™ì ìœ¼ë¡œ ë¡œë“œ
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js';
                    document.head.appendChild(script);

                    await new Promise(resolve => {
                        script.onload = resolve;
                    });

                    const zip = new JSZip();
                    const folder = zip.folder('youtube_scenes');

                    // ìƒíƒœ í‘œì‹œ
                    const statusDiv = document.createElement('div');
                    statusDiv.className = 'fixed top-4 right-4 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                    statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ZIP íŒŒì¼ ìƒì„± ì¤‘...';
                    document.body.appendChild(statusDiv);

                    // ê° ì´ë¯¸ì§€ì™€ ìŒì„±ì„ ZIPì— ì¶”ê°€
                    for (let i = 0; i < generatedImages.length; i++) {
                        const item = generatedImages[i];
                        if (!item.imageUrl) continue; // ì‹¤íŒ¨í•œ í•­ëª© ê±´ë„ˆë›°ê¸°
                        
                        statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>íŒŒì¼ ì¶”ê°€ ì¤‘... (' + (i + 1) + '/' + generatedImages.length + ')';
                        
                        try {
                            // ì´ë¯¸ì§€ ì¶”ê°€
                            const imageResponse = await fetch(item.imageUrl);
                            const imageBlob = await imageResponse.blob();
                            const imageFilename = 'scene_' + String(i + 1).padStart(2, '0') + '.png';
                            folder.file(imageFilename, imageBlob);
                            
                            // ìŒì„± ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
                            if (item.audioUrl) {
                                try {
                                    const audioResponse = await fetch(item.audioUrl);
                                    const audioBlob = await audioResponse.blob();
                                    const audioFilename = 'scene_' + String(i + 1).padStart(2, '0') + '.mp3';
                                    folder.file(audioFilename, audioBlob);
                                } catch (audioError) {
                                    console.error('ìŒì„± ' + (i + 1) + ' ì¶”ê°€ ì‹¤íŒ¨:', audioError);
                                }
                            }
                        } catch (error) {
                            console.error('íŒŒì¼ ' + (i + 1) + ' ì¶”ê°€ ì‹¤íŒ¨:', error);
                        }
                    }

                    statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ZIP íŒŒì¼ ì••ì¶• ì¤‘...';

                    // ZIP íŒŒì¼ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
                    const content = await zip.generateAsync({ type: 'blob' });
                    const url = URL.createObjectURL(content);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'youtube_scenes_' + new Date().getTime() + '.zip';
                    a.click();
                    URL.revokeObjectURL(url);

                    statusDiv.innerHTML = '<i class="fas fa-check-circle mr-2"></i>ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!';
                    setTimeout(() => {
                        document.body.removeChild(statusDiv);
                    }, 2000);

                } catch (error) {
                    alert('ZIP íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
                }
            }

            async function recommendTitle() {
                const storyText = document.getElementById('storyText').value.trim();
                if (!storyText) {
                    alert('ë¨¼ì € ìŠ¤í† ë¦¬ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }

                const recommendationsDiv = document.getElementById('titleRecommendations');
                recommendationsDiv.innerHTML = '<div class="text-center py-2"><i class="fas fa-spinner fa-spin text-blue-600"></i> AIê°€ ì œëª©ì„ ì¶”ì²œí•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>';
                recommendationsDiv.classList.remove('hidden');

                try {
                    const response = await fetch('/api/recommend-title', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ story: storyText })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        recommendationsDiv.innerHTML = '';
                        
                        data.titles.forEach((title, index) => {
                            const titleCard = document.createElement('div');
                            titleCard.className = 'flex items-center gap-2 p-2 bg-white border border-indigo-200 rounded-lg hover:bg-indigo-50 cursor-pointer transition';
                            titleCard.onclick = () => {
                                document.getElementById('videoTitle').value = title;
                                recommendationsDiv.classList.add('hidden');
                            };
                            titleCard.innerHTML = '<i class="fas fa-star text-yellow-500"></i>' +
                                '<span class="flex-1 text-gray-800">' + title + '</span>' +
                                '<i class="fas fa-chevron-right text-gray-400"></i>';
                            recommendationsDiv.appendChild(titleCard);
                        });
                    } else {
                        throw new Error(data.error || 'ì œëª© ì¶”ì²œ ì‹¤íŒ¨');
                    }
                } catch (error) {
                    recommendationsDiv.innerHTML = '<div class="text-red-600 text-sm"><i class="fas fa-exclamation-triangle mr-1"></i>' + error.message + '</div>';
                }
            }

            async function generateThumbnail() {
                const videoTitle = document.getElementById('videoTitle').value.trim();
                if (!videoTitle) {
                    alert('ì˜ìƒ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                    return;
                }

                if (!confirm('"' + videoTitle + '" ì œëª©ìœ¼ë¡œ ì¸ë„¤ì¼ì„ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì•½ 2-3ë¶„ ì†Œìš”)')) {
                    return;
                }

                // ì¸ë„¤ì¼ ì„¹ì…˜ í‘œì‹œ
                const thumbnailSection = document.getElementById('thumbnailSection');
                thumbnailSection.classList.remove('hidden');
                thumbnailSection.scrollIntoView({ behavior: 'smooth' });

                const thumbnailStatus = document.getElementById('thumbnailStatus');
                const thumbnailPreview = document.getElementById('thumbnailPreview');
                const thumbnailDownload = document.getElementById('thumbnailDownload');

                thumbnailStatus.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ì¸ë„¤ì¼ ìƒì„± ì¤‘... (2-3ë¶„ ì†Œìš”)';
                thumbnailPreview.classList.add('hidden');
                thumbnailDownload.classList.add('hidden');

                try {
                    const prompt = STYLE_PROMPT + '

Reference Image: ' + REFERENCE_IMAGE + '
(Please analyze and replicate the visual style from this reference image)

Title: ' + videoTitle + '

Create an eye-catching YouTube thumbnail that represents this video title. 
The thumbnail should be visually striking, professional, and engaging.
Include bold, readable text if needed to emphasize the main message.
Use contrasting colors to make the thumbnail stand out.
Aspect ratio: 16:9 for YouTube compatibility.
Make it click-worthy and attention-grabbing!';

                    const response = await fetch('/api/generate-scene-image', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            scene: { description: videoTitle, visualElements: 'YouTube thumbnail design', duration: 0 },
                            prompt: prompt,
                            index: -1
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        thumbnailStatus.innerHTML = '<i class="fas fa-check-circle text-green-600 mr-2"></i>ì¸ë„¤ì¼ ìƒì„± ì™„ë£Œ!';
                        
                        const img = thumbnailPreview.querySelector('img');
                        img.src = data.imageUrl;
                        thumbnailPreview.classList.remove('hidden');

                        thumbnailDownload.href = data.imageUrl;
                        thumbnailDownload.classList.remove('hidden');
                    } else {
                        throw new Error(data.error || 'ìƒì„± ì‹¤íŒ¨');
                    }
                } catch (error) {
                    thumbnailStatus.innerHTML = '<i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>ì‹¤íŒ¨: ' + error.message;
                }
            }
        </script>
    </body>
    </html>
  